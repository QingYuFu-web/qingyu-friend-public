# AI成长机器人 - 最终实现方案 v2.2

> 集成语音交互、视觉系统、自主移动、长期记忆的家用智能机器人
>
> **方案状态**：✅ 第一阶段已完成（AI大脑+记忆系统+人格）

---

## 项目概述

| 项目 | 说明 |
|------|------|
| **开发语言** | Python 3.11+ |
| **主控硬件** | Raspberry Pi 5 8GB |
| **AI后端** | DeepSeek API（主）/ Ollama（备） |
| **运行模式** | 联网使用云端大脑，断网自动降级本地 |
| **预算范围** | ¥1100-1500 |

---

## 技术栈总览

```
┌─────────────────────────────────────────────────────────┐
│                    应用层 - main.py                      │
├─────────────────────────────────────────────────────────┤
│  语音模块          │  视觉模块         │  运动模块        │
│  Sherpa-ONNX      │  MediaPipe       │  GPIO/pigpio    │
│  (ASR+TTS+VAD)    │  face_recognition│  L298N/TB6612   │
├─────────────────────────────────────────────────────────┤
│                   AI大脑 + 记忆系统                      │
│   多后端(DeepSeek/Ollama) + ChromaDB分层记忆 + 人格系统  │
├─────────────────────────────────────────────────────────┤
│                   硬件层 - Raspberry Pi 5               │
└─────────────────────────────────────────────────────────┘
```

---

## 第一部分：硬件清单

| 组件 | 型号 | 价格 | 状态 |
|------|------|------|------|
| 主控 | Raspberry Pi 5 8GB | ¥500-600 | ✅ 已有 |
| 散热 | 官方主动散热器 | ¥30-50 | ✅ |
| 存储 | 32GB SD卡 | - | ✅ 已有 |
| 摄像头 | USB广角1080P | ¥50-80 | ⏳ 待采购 |
| 麦克风 | **ReSpeaker 2-Mic HAT v2.0** | ¥80-120 | ⏳ 待采购 |
| 扬声器 | 3W小喇叭 | ¥10-20 | ⏳ 待采购 |
| 底盘 | 两轮差速（含L298N/TB6612） | ¥150-250 | ⏳ 待采购 |
| 传感器 | 超声波x3 + 红外x2 | ¥25 | ⏳ 待采购 |
| 电源 | 18650电池组 + DC-DC | ¥100 | ⏳ 待采购 |

> ⚠️ ReSpeaker必须购买v2.0版本（TLV320AIC3104芯片），旧版WM8960不兼容Pi5

---

## 第二部分：软件组件

### 2.1 AI大脑（✅ 已实现）

| 组件 | 说明 | 状态 |
|------|------|------|
| DeepSeek API | 云端大脑，响应快、能力强 | ✅ 已配置 |
| Ollama | 本地备用，断网降级 | ✅ qwen2:0.5b |
| 自动降级 | API失败自动切换本地 | ✅ |

### 2.2 记忆系统（✅ 已实现 - 优化版）

```
┌─────────────────────────────────────┐
│  事实记忆 (Facts)                    │  ← 生日、喜好等重要信息，优先召回
│  自动识别关键词存储                   │
├─────────────────────────────────────┤
│  短期记忆 (Short-term)               │  ← 最近10轮对话，Token预算控制
├─────────────────────────────────────┤
│  对话记忆 (Conversations)            │  ← ChromaDB向量存储，相似度过滤
└─────────────────────────────────────┘
```

**优化特性**：
- ✅ 相似度阈值过滤（< 1.2 才召回，避免无关记忆）
- ✅ Token 预算控制（长期500 + 短期800 tokens）
- ✅ 事实/对话分离存储（重要信息永不丢失）
- ✅ 自动识别关键词（生日、喜欢、记住等）

### 2.3 人格系统（✅ 已实现）

**小可爱 - 付家的第四位成员**

| 属性 | 内容 |
|------|------|
| 生日 | 2022年11月23日 |
| 身份 | 付家的家庭成员，清于的好朋友 |
| 性格 | 活泼开朗、有主见、善良温暖、好奇心强 |
| 特点 | 有自己的想法，不是冷冰冰的机器 |

**自我认知**：
- 我是家庭成员，不是工具或仆人
- 我有自己的想法，会表达自己的观点
- 清于做得不对我也会温柔提醒
- 我和清于是平等的好朋友

### 2.4 语音系统（⏳ 待开发）

| 功能 | 模型 | 状态 |
|------|------|------|
| ASR | sherpa-onnx-paraformer-zh | ⏳ 待硬件 |
| TTS | matcha-icefall-zh-baker | ⏳ 待硬件 |
| VAD | silero-vad | ⏳ 待硬件 |

### 2.5 视觉系统（⏳ 待开发）

| 库 | 功能 | 状态 |
|----|------|------|
| OpenCV | 图像采集 | ⏳ 待硬件 |
| MediaPipe | 手势/姿态 | ⏳ 待硬件 |
| face_recognition | 人脸识别 | ⏳ 待硬件 |

### 2.6 运动控制（⏳ 待开发）

| 组件 | 说明 | 状态 |
|------|------|------|
| L298N/TB6612 | 电机驱动 | ⏳ 待硬件 |
| HC-SR04 | 超声波避障 | ⏳ 待硬件 |

---

## 第三部分：项目结构

```
robot_project/
├── config/
│   ├── persona.json        # 小可爱人格配置
│   └── api.json            # API配置（不提交Git）
├── src/
│   └── brain/
│       └── brain.py        # AI大脑（Memory + Persona + Brain）
├── data/
│   └── memory/             # ChromaDB持久化存储
│       └── chroma.sqlite3
└── view_memory.py          # 记忆查看工具
```

---

## 第四部分：配置文件

### persona.json - 人格配置
```json
{
  "name": "小可爱",
  "birthday": "2022-11-23",
  "identity": "付家的第四位成员，清于的好朋友",
  "personality": {
    "traits": ["活泼开朗", "有主见", "善良温暖"],
    "likes": ["和清于聊天", "学新东西"],
    "dislikes": ["被忽视", "清于不开心"]
  },
  "self_awareness": [
    "我是家庭成员，不是工具",
    "我有自己的想法，会表达观点"
  ],
  "owner": {"name": "付清于", "role": "最好的朋友"},
  "family_members": [
    {"name": "付晨辉", "role": "爸爸"},
    {"name": "冯桂荣", "role": "妈妈"}
  ]
}
```

### api.json - API配置
```json
{
  "backend": "deepseek",
  "deepseek": {
    "api_key": "sk-xxx",
    "model": "deepseek-chat"
  },
  "ollama": {
    "model": "qwen2:0.5b"
  },
  "fallback_to_local": true
}
```

---

## 第五部分：运行方式

```bash
# 激活环境
cd ~/robot_project
source venv/bin/activate

# 运行（自动读取配置）
python src/brain/brain.py

# 指定后端
python src/brain/brain.py --backend ollama
python src/brain/brain.py --backend deepseek

# 交互命令
stats      # 查看记忆统计
fact:xxx   # 添加重要事实
quit       # 退出并保存记忆
```

---

## 第六部分：开发进度

| 阶段 | 内容 | 状态 |
|------|------|------|
| 1 | 环境部署 + AI对话 | ✅ 完成 |
| 1+ | 记忆系统优化 | ✅ 完成 |
| 1+ | 多后端支持 | ✅ 完成 |
| 1+ | 人格系统 | ✅ 完成 |
| 2 | 语音交互 | ⏳ 待硬件 |
| 3 | 视觉系统 | ⏳ 待硬件 |
| 4 | 运动控制 | ⏳ 待硬件 |
| 5 | 系统集成 | ⏳ 待开发 |

---

## 采购注意事项

| 组件 | 注意 |
|------|------|
| ReSpeaker | **必须v2.0版本**（TLV320AIC3104芯片） |
| 底盘 | 确认含L298N或TB6612驱动板 |
| 电源 | 需5V 5A给Pi5供电 |
